---
title: "UQM paper outputs"
author: "KZ"
date: "29 June 2015"
output: html_document
---
  

```{r, echo=FALSE, message=FALSE}
#clean workspace
rm(list=ls())

#packages
#require(RCurl)
# require(bitops)
require(reshape2)
require(dplyr)

#load data
#folder = "./Data Stage 2/"
demog = read.csv("./Data Stage 2/demog.csv", header=TRUE, stringsAsFactors=FALSE)
AcP = read.csv("./Data Stage 2/AcPdf.csv", header=TRUE, stringsAsFactors=FALSE)
FbPsum = read.csv("./Data Stage 2/FbPsummary.csv", header=TRUE, stringsAsFactors=FALSE)
FbP = read.csv("./Data Stage 2/FbPdf.csv", header=TRUE, stringsAsFactors=FALSE)
FbU = read.csv("./Data Stage 2/FbUdf.csv", header=TRUE, stringsAsFactors=FALSE)
AcPFbUbins = read.csv("./Data Stage 2/AcPFbUbins.csv", header=TRUE, stringsAsFactors=FALSE)


#load functions
source("UQM functions.R")
source("HelperFunctions.R")

ProjectID = read.csv("./Data Stage 1/ProjectIDs.csv")
projects()
graphs()

stats.mean.sem = function(df, dv, iv)
{
  means = tapply(df[,dv], df[,iv], mean, na.rm=T)
  st.dev = tapply(df[,dv], df[,iv], sd, na.rm=T)
  n = tapply(df[,dv], df[,iv], length)
  SEM = st.dev/sqrt(n)
  stats = as.data.frame(means)
  stats = cbind(stats, SEM)
  return(stats)
}

#Generalising
gen = function(df, col.course, col.sem){
  df[,col.course] = gsub("BIOL1040", "Level 1", df[,col.course])
  df[,col.course] = gsub("BIOM2011", "Level 2", df[,col.course])
  df[,col.sem] = gsub("Sem1", "Semester 1", df[,col.sem])
  df[,col.sem] = gsub("Sem2", "Semester 2", df[,col.sem])
  return(df)
}

demog = gen(demog, 13, 14)
AcP = gen(AcP, 7, 8)
#FbPsum does not inlude project details, need to merge in from AcP
#FbP.sum = merge(FbPsum, AcP, by="SubmissionID", all.y=T)
#FbP.sum[which(is.na(FbP.sum[,2])),] #bunch of Submissions for which there are marks but no meta-data on Fb provision - possible error in generating FbPsummary?
#ignoring this for now and just generating Fig 2-4 based on data that is in FbPsummary.csv
FbP.AcP = merge(FbPsum, AcP, by="SubmissionID")

```


#Methods
##Student cohort  
```{r, echo=FALSE}
df = subset(demog, Course.Grade !="withrawn")
temp = df %>% group_by(course, sem) %>% tally()
temp2 = as.data.frame(round(prop.table(table(df[,5])),2)*100)

df[,4] = as.Date(df[,4], "%d/%M/%Y")
sem1 = as.Date("2013-03-01")
df2 = df %>% select(Date.of.Birth) %>% mutate(sem1 - Date.of.Birth)
df2$age = as.numeric(df2[,2])%/%365
#df2[1:10,]
#table(df2[,3])
bins = c(0, 16, 21, 60)
df2$age.bin = cut(df2[,3], bins)
#head(df2, n=20)
temp3 = as.data.frame(round(prop.table(table(df2$age.bin)),2)*100)

temp4 = as.data.frame(round(prop.table(table(df$International.Indicator.Code)),2)*100)
#temp4 = as.data.frame(round(prop.table(table(df$International.Indicator.Code)),2)*100)
#round(prop.table(table(df$UQ.Translated.Base.OP)),2)*100

bin.op = c(0, 8, 20)

temp5 = as.data.frame(round(prop.table(table(cut(df$UQ.Translated.Base.OP, bin.op))),2)*100)

```


During the period of this study, there were `r temp[1,3]` and `r temp[2,3]` students enrolled in the level 1 course, and `r temp[3,3]` and `r temp[3,3]` students enrolled in the level 2 course in 2013 Semesters 1 and 2, respectively. There were slightly more `r tolower(temp2[1,1])` (`r temp2[1,2]`%) than `r tolower(temp2[2,1])` (`r temp2[2,2]`%)  students, the vast majority (`r temp3[2,2]`%) were 17 â€“ 21 years old, domestic students (`r temp4[1,2]`%), with high- to mid-range university entry scores (`r temp5[1,2]`%). 


**_need to get program data to check the following:_**    
Just over half (53%) of the students taking these courses were enrolled in a three-year Bachelor of Science (BSc) or four-year dual degree combining BSc with another degree, or the Bachelor of Biomedical Science (four year research-focused program). An additional 21% were enrolled in one of four sports science degrees, and 12% were enrolled in the combined BSc/Medical program (in which students undertake an accelerated two-year BSc program and then enter a four-year, graduate entry Medical program). The remaining students were enrolled in a large range of single and dual degrees (e.g. Arts, Engineering), specialty degrees and applied science degrees.  


##Data collection and analysis  
```{r, echo=FALSE}
temp = length(unique(AcP$SubmissionID))
```
A total of `r temp` reports submitted and marked through FACS in semester 1 and 2, 2013 were used for this study. The modality, length (in time or number of words) and position of each feedback annotation provided on all reports was recorded, and the time taken to mark each collated. Clickstream data logs were collected as students accessed their marked documents, providing information on opening dates and durations, and student interaction with the feedback annotations. Data on student academic performance for each report were also collated. Throughout this study, quantitative analyses were performed using R 3.1.1 (R Development Core Team, Auckland, NZ). The results were expressed as mean and standard error of the mean (SEM), and were considered significant if p<0.05. 

#Results and Discussion    
```{r, echo=FALSE, warning=FALSE, message=FALSE}
temp = dcast(AcP, course + sem ~ report)
#temp
df = subset(demog, Course.Grade !="withrawn")
temp2 = as.data.frame(df %>% group_by(course) %>% tally())
```

The increasing availability of online technologies, which allow the provision of multimodal feedback annotations that can be generalised or situated, has certainly increased the variety and flexibility of feedback delivery options (refs). However, it has also increased the variability of feedback provision and changed the way in which students interact with feedback, leading to potentially greater variability in student outcomes (refs). The primary aims of this study were to understand how the different modalities of feedback available through online technologies affected feedback provisionboth across successive student assessment tasks and within large cohorts with multiple markers, and to examine the way students interacted with the feedback provided. Analyses of FACS data from laboratory reports submitted for assessment (Table 1) in two biomedical science courses in level 1 (n = `r temp2[1,2]` students) and level 2 (n = `r temp2[2,2]`), in Semesters 1 and 2, 2013, have shown that there are significant differences in the ways in which markers use the different modalities of feedback (Figure 2-4). In addition, the data demonstrates that there are substantial differences in the way students interact with their marked reports and feedback within them across the semesters (Figures 5-8).

Table 1: Number of assignments processed through FACS  
```{r, echo=FALSE}
temp
```
NB Report 4 for the level 1 course in semester 2 was administered by another academic department which did not participate in the FACS trial.



```{r, echo=FALSE, fig.width=10, fig.height=5}

default.plot()
par(oma = c(0, 0, 1.0, 0))
par(mfrow=c(1,2))
par(mar = c(4.5, 4.1, 2.1, 1.5))

plot.mean.sem(FbP.AcP, 4, 14, 20, report.col, report.names, "Number of audio annotations per report")
plot.mean.sem(FbP.AcP, 5, 14, 20, report.col, report.names, "Number of text annotations per report")

par(fig = c(0, 1, 0, 1), oma = c(0, 0, 0, 0), mar = c(0, 0, 0, 0), new = TRUE)
plot(0, 0, type = "n", bty = "n", xaxt = "n", yaxt = "n")
legend("top", legend = sem.names,  xpd = TRUE, horiz = TRUE, inset = c(0, 0), fill = kz.col, bty="n")

temp = as.data.frame(table(FbP.AcP[,15], FbP.AcP[,17]))

```

Figure 2: Number of audio and text annotations for level 1 course (Report 0: n=`r temp[1,3]`, Report 1: n=`r temp[3,3]`, Report 2: n=`r temp[5,3]`, Report 3: n=`r temp[7,3]` and for the level 2 course (Report 1: n=`r temp[4,3]`, Report 2: n=`r temp[6,3]`). Shown is the A)  Mean+/-SEM number of audio annotations per report across two semesters of level 1 and 2 subjects; B)  Mean+/-SEM number of text annotations per report across two semesters of level 1 and 2 subjects.


```{r, echo=FALSE, fig.width=10, fig.height=5}

audio = subset(FbP, AnnotType == "Recording")
text = subset(FbP, AnnotType == "Text")

default.plot()
par(oma = c(0, 1.0, 1.0, 0))
par(mfrow=c(1,2))
par(mar = c(4.5, 4.9, 2.1, 1.5))

plot.mean.sem(audio, 18, 14, 170, report.col, report.names, "Number of words per audio annotation \n per report")
plot.mean.sem(text, 18, 14, 17, report.col, report.names, "Number of words per text annotation \n per report")

par(fig = c(0, 1, 0, 1), oma = c(0, 0, 0, 0), mar = c(0, 0, 0, 0), new = TRUE)
plot(0, 0, type = "n", bty = "n", xaxt = "n", yaxt = "n")
legend("top", legend = sem.names,  xpd = TRUE, horiz = TRUE, inset = c(0, 0), fill = kz.col, bty="n")

temp = as.data.frame(table(FbP.AcP[,15], FbP.AcP[,17]))

#Kay wanted range of audio durations (sec) for later text
#temp3 = as.data.frame(tapply(FbP[,12], FbP[,14], mean, na.rm=T))
#temp4 = NULL
#for(i in 1:11)
#  temp4[[i]] = se(subset(FbP, project == project.names.formative[i]), 12)
#temp3
#temp4  
  
```

Figure 3: Number of words provided in each audio and text annotation for level 1 course (Report 0: n=`r temp[1,3]`, Report 1: n=`r temp[3,3]`, Report 2: n=`r temp[5,3]`, Report 3: n=`r temp[7,3]` and for the level 2 course (Report 1: n=`r temp[4,3]`, Report 2: n=`r temp[6,3]`). Shown is the A) Mean+/-SEM number of words in each audio annotation in reports across two semesters and levels; B) Mean+/-SEM number of words in each text annotation in reports across two semesters and two levels. *NB The y-axis scale for A is 10x the y-axis scale for B.*


```{r, echo=FALSE, fig.width=10, fig.height=5}

default.plot()
par(oma = c(0, 0, 1.0, 0))
par(mfrow=c(1,2))
par(mar = c(4.5, 4.1, 2.1, 1.5))

plot.mean.sem(FbP.AcP, 8, 14, 1700, report.col, report.names, "Number of words in audio annotations per report")
plot.mean.sem(FbP.AcP, 9, 14, 170, report.col, report.names, "Number of words in text annotations per report")

par(fig = c(0, 1, 0, 1), oma = c(0, 0, 0, 0), mar = c(0, 0, 0, 0), new = TRUE)
plot(0, 0, type = "n", bty = "n", xaxt = "n", yaxt = "n")
legend("top", legend = sem.names,  xpd = TRUE, horiz = TRUE, inset = c(0, 0), fill = kz.col, bty="n")

temp = as.data.frame(table(FbP.AcP[,15], FbP.AcP[,17]))

```

Figure 4: Total amount of feedback provided in audio and text feedback for level 1 course (Report 0: n=`r temp[1,3]`, Report 1: n=`r temp[3,3]`, Report 2: n=`r temp[5,3]`, Report 3: n=`r temp[7,3]` and for the level 2 course (Report 1: n=`r temp[4,3]`, Report 2: n=`r temp[6,3]`). Shown is the A) Mean+/-SEM number of words in audio annotations in reports across two semesters and levels; B) Mean+/-SEM number of words in text annotations in reports across two semesters and two levels. *NB The y-axis scale for A is 10x the y-axis scale for B.*




```{r, echo=FALSE, fig.width=10, fig.height=5}

looked = 
  
  addmargins(prop.table(table(AcPFbUbins[,6], AcPFbUbins[,11]),1))

default.plot()
par(oma = c(0, 0, 1.0, 0))
par(mfrow=c(1,2))
par(mar = c(4.5, 4.1, 2.1, 1.5))

barplot(looked, names = report.names, las=2, col=report.col, ylim=c(0,100), ylab="Number of Students (% of cohort)", main = "Proportion of students who \nlooked at their feedback for each report")


par(fig = c(0, 1, 0, 1), oma = c(0, 0, 0, 0), mar = c(0, 0, 0, 0), new = TRUE)
plot(0, 0, type = "n", bty = "n", xaxt = "n", yaxt = "n")
legend("top", legend = sem.names,  xpd = TRUE, horiz = TRUE, inset = c(0, 0), fill = kz.col, bty="n")

temp = as.data.frame(table(FbP.AcP[,15], FbP.AcP[,17]))

```


Figure 5 The proportion of students who looked at feedback. Shown are the proportions of students who viewed their report feedback of level one (BIOL 1040 Sem1:  4 reports, Sem2:  3 reports) and level two (BIOM 2011 Sem1 and Sem2: 2 Reports) courses across two semesters. Report 1 of BIOL1040 Sem1 was a formative submission while the subsequent reports were all summative. . Data are expressed as the cohort average


Figure 6 The duration students had their report feedback open. Shown is the overall duration (minutes) that students had their report feedback open in level one (BIOL 1040 Sem1:  4 reports, Sem2:  3 reports) and level two (BIOM 2011 Sem1 and Sem2: 2 Reports) courses. Data are expressed as the cohort average + SEM.


Figure 7 Number of students and their feedback access duration in level one (BIOL1040) semester one course. Shown is the log transformed sample duration of student access to their feedback in A) BIOL1040 semester 1, report 1, B) BIOL1040 semester 1, report 4, C) BIOM2011 semester 1, report 1; D) BIOM2011 semester 1, report 2. 


Figure 8 Pause duration between clicks whilst perusing feedback. Bar graph of the time interval between clicks while students look through assessment feedback for level 1 course (Report 1: n=1576, Report 2: n=1634, Report 3: n=1604, Report 4: n=707 and for the level 2 course (Report 1: n=333, Report 2: n=330); Significance was found between non-final (BIOL1040Sem1: Reports 1-3, BIOL1040Sem: Reports 1and 2, BIOM2011Sem1: Report 1, BIOM2011Sem2: Report 1) and final reports (BIOL1040Sem1: Report 4, BIOL1040Sem: Report3, BIOM2011Sem1: Report 2, BIOM2011Sem2: Report 2). 


